# README

## Installing

Using npm

```shell
npm install @xmly/sniffing-sdk
```

Using yarn

```shell
yarn add @xmly/sniffing-sdk
```

Using umd CDN

```
<script src="../dist/sniffing-sdk.min.js"></script>
```



## Usage

### 初始化

在入口文件中初始化sniffing

```react
//app.js
import sniffing from '@xmly/sniffing-sdk'
import trackerMap from './trackerMap'
import {start} from '@xmly/xmrep'
sniffing.init(trackerMap, {
    debugger: true,
    autoExpo: true,
    xmrep: {
      start: start,
      params: {
        b: "bid"
        c: {
          parmas: "xxx"
        }
      }
    }
})
```

其中bid为初始代码中的b

```js
//从代码埋点平台下载的初始代码
start({
  b: 135,
  c: {},
});
```



| 参数                            | 类型                | 说明                               |
| ------------------------------- | ------------------- | ---------------------------------- |
| TrackerMap                      | TrackerEvent        | 注册事件列表                       |
| Options（可选）                 |                     | 初始化配置                         |
| Options.debugger（可选）        | Boolean             | 是否开启日志，默认false            |
| Options.autoExpo（可选）        | Boolean             | 是否开启曝光埋点，默认false        |
| Options.autoPageTracker（可选） | Boolean             | 是否开启页面路由变化埋点，默认true |
| Options.xmrep（可选）           |                     | xmrep初始化配置                    |
| Options.xmrep.start（可选）     |                     | @xmly/xmrep中的start方法           |
| Options.xmrep.params（可选）    |                     | xmrep配置参数                      |
| Options.router.type（可选）     | "hash" \| "browser" | 路由类型， 默认“browser”           |

```react
//在配置表中配置
//trackerMap.js (TrackerMap)
import { ubt } from '@xmly/xmrep';
export default {
  '5514 clickLink': ({ id }: { id: string }) => {
    ubt.click(5514, 'link', { currPage: 'demo', productId: id });
  },
  '5515 clickButton': ({ id }: { id: string }) => {
    ubt.click(5515, 'button', { currPage: 'demo', productId: id });
  },
}
```



### 追加埋点配置表

```react
import sniffing from '@xmly/sniffing-sdk'
import trackerMap from './trackerMap'
sniffing.install(trackerMap)
```

### 手动触发

```react
import sniffing from '@xmly/sniffing-sdk'

sniffing.manualTrack('0014', JSON.stringify({id: "0004", name: "xxx fourth"}))
```



### 标签规范

#### 点击埋点

```html
<button data-ubt-click="5518" data-ubt-params={JSON.stringify({id: 'xxx'})} >
  click me
</button>
```

#### 曝光埋点

```html
<div data-ubt-expo="3332" data-ubt-params={JSON.stringify({id: 'xxx'}>  
      曝光埋点3332
</div>
```

#### 路由变化埋点(需要根据下载下来的sniffing格式略微修改，否则无法生效)

在配置表中配置，与之前sniffing的区别在于leave和enter后面需要增加路由名字，如有动态路由根据path-to-regexp包的match方法进行匹配，例如 **/developer/article/:id**

```ts
import { match } from 'path-to-regexp'

export const pathIsEqual = (path: string, rep?: string) => {
  if (!rep) return false
  const matchBrowserUrl = match(rep, { decode: decodeURIComponent })
  return matchBrowserUrl(path)
}
```



```react
import { ubt } from '@xmly/xmrep';
export default {
    '5511 leave /other': () => {
         ubt.pageExit(5513, { currPage: 'demo' });
    },
    '5513 enter /home': () => {
        ubt.pageView(5512, 'demo');
    },
    '5514 leave /home': () => {
         ubt.pageExit(5513, { currPage: 'demo' });
    },
    '5513 enter /': () => {
        ubt.pageView(5512, 'demo');
    },
    '5514 leave /': () => {
        ubt.pageExit(5513, { currPage: 'demo' });
    },
}
```

hash路由配置

```react
import { ubt } from '@xmly/xmrep';
export default {
    '5511 leave #/other': () => {
         ubt.pageExit(5513, { currPage: 'demo' });
    },
    '5513 enter #/home': () => {
        ubt.pageView(5512, 'demo');
    },
    '5514 leave #/home': () => {
         ubt.pageExit(5513, { currPage: 'demo' });
    },
    '5513 enter #/': () => {
        ubt.pageView(5512, 'demo');
    },
    '5514 leave #/': () => {
        ubt.pageExit(5513, { currPage: 'demo' });
    },
}
```



## Example

