# xmrep

## 简介

Web 集成上报 SDK，包含了 UBT、APM、XMLog 和 分享追踪等功能数据的上报。

## UBT

新版数据上报，对接数据团队后端，可以配合魔镜系统进行数据的可视化展示。

### 使用

```javascript
import { start } from "@xmly/xmrep";

start({
  b: "1011",
  c: { commonProp: "NeedReport" },
});
```

### 配置项

- b，bussinessId 的简写，表示业务 ID，用于对数据进行区分隔离，必填项。
- c，customCommon 的简写，表示自定义的通用字段，当中的值会在每次上报时随 `ext` 字段进行发送，选填项。
- tid，thirdpartyId 的简写，表示微信公众号在喜马体系下的登记 ID，用于在微信环境下进行授权，通过授权可以获取到更加准确的用户信息，选填项。
- ak，appKey 的简写，表示微信公众号的 appKey，用于在微信环境下获取用户的微信 openid 来唯一标识用户，选填项。

### 相关文档

- [接入文档](http://gitlab.ximalaya.com/mermaid/mermaid-docs/wikis/h5-%E6%89%8B%E5%8A%A8%E5%9F%8B%E7%82%B9%E6%8E%A5%E5%85%A5%E6%96%87%E6%A1%A3)
- [上报字段说明](http://gitlab.ximalaya.com/mermaid/mermaid-docs/wikis/h5-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E7%99%BB%E8%AE%B0)
- [小程序接入](http://gitlab.ximalaya.com/tangliang/xlog-xmlite)

## APM

页面性能指标的监控上报，可以配合 [APM Web](http://cms.9nali.com/mermaid-apm-glass/h5/ui/page-load) 功能进行数据的查看。

### 使用

```javascript
import { apm } from "@xmly/xmrep";
apm.init({
  name: "yunxiao_name",
});
```

### 配置项

- name，项目的云效应用名，用于对性能数据进行聚合，必填项。
- type，监控类别，支持页面加载性能、请求性能和资源载入性能三部分内容，分别用二进制的 `0010`、`0100` 和 `1000` 控制是否开启，全部开启为 `1110`，默认为 `0110`，选填项。
- sampleRate，采样率，0~1 之间的数字，0.1 表示采样率 10%，默认为 0.5，选填项。
- maxRequestMonitorQueueLength，请求监控数据采集队列最大长度，默认为 1，选填项。
- maxResourceMonitorQueueLength，资源监控数据采集队列最大长度，默认为 1，选填项。
- requestMonitorWhitelist，请求监控白名单，白名单中的请求地址将被忽略，支持正则表达式，选填项。
- resourceMonitorWhitelist，资源监控白名单，白名单中的资源地址将被忽略，支持正则表达式，选填项。
- routeMap，前端路由映射，用于归类页面地址，选填项。

## XMLog

原有的 XMLog 数据上报方式，对接 xdcs 数据后端。

### 使用

```javascript
import { xmLog } from "xmrep";

// 默认 tracker
xmLog.init({ ...commonprops }); // 可选
xmLog.pageView({ ...props });
xmLog.event({ ...props });

// 自定义 tracker
const myTracker = new xmLog({ ...commonprops });
myTracker.pageView({ ...props });
myTracker.event({ ...props });
```

## 分享追踪

### 使用

```typescript
import { start, share } from "xmrep";

start({
  b: "1011",
});

share.state((data: IShare));

share.feedback((data: IShare));

interface IShare {
  /** 页面url */
  url: string;
  /** 分享id */
  sstid: string;
  /** 分享深度 */
  ssdl: string;
  /** 分享设备 app/weixin/browser */
  ssdt: string;
  /** 分享设备id */
  ssdv: string;
  /** 分享方式 */
  type: string;
}
```

### 相关文档

- [文档地址](https://note.youdao.com/ynoteshare1/index.html?id=75b8cf86307659a716a45e7b786c75be&type=note)
