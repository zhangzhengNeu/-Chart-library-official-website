import { cookie } from '../utils/storage';
import { isDev } from '../utils/env';
import { info } from '../share/app';
// 微信读取只有test/prod
var isTest = isDev();
export function check(appKey, thirdpartyId) {
    if (!appKey && !thirdpartyId) {
        return true;
    }
    if (appKey && thirdpartyId) {
        var openId = cookie.get("wxopenid_" + appKey + "_" + (isTest ? 4 : 1));
        if (!openId) {
            wxAuth(thirdpartyId, location.href);
            return false;
        }
        info.deviceId = openId;
        return true;
    }
    if (isTest) {
        throw new Error('appKey和thirdpartyId必须都存在');
    }
    return false;
}
function wxAuth(thirdpartyId, fromUri) {
    // http://gitlab.ximalaya.com/x-fm/xpassport/wikis/%E7%AC%AC%E4%B8%89%E6%96%B9h5%E7%99%BB%E5%BD%95(302%E5%9B%9E%E8%B0%83)
    location.href = "https://passport" + (isTest ? '.test' : '') + ".ximalaya.com/thirdparty-h5/v1/auth/" + thirdpartyId + "/wx/baseAuthorizeAndRedirect?fromUri=" + encodeURIComponent(fromUri);
}
